.include "../../../topscreen.s"
.include "../../../common.s"

.global main
main:
	push {r4, lr}
	bl setup

    @ Print intro text.
    ldr r0, =intro
    bl printf

    @ Use r7-r9 to store the 3 highest calorie totals.
    eor r7, r7      @ Current highest = 0.
    eor r8, r8      @ Current 2nd highest = 0.
    eor r9, r9      @ Current 3rd highest = 0.
    eor r0, r0      @ Elf running total = 0.
    eor r4, r4      @ Current character = 0.
    ldr r2, =data

.elfLoop:
    ldrb r4, [r2]   @ Get character.
    cmp r4, #'\n'   @ Check if newline a.k.a elf is done.
    beq .elfDone
    @ If end of file, still branch to elfDone to check last elf.
    ldrb r4, [r2]   @ Get character.
    cmp r4, #'\0'   @ Check if null terminator a.k.a end of data.
    beq .elfDone

    bl parseInt
    add r0, r0, r3  @ Add parsed integer to elf's running total.
    b .elfLoop
.elfDone:
    cmp r7, r0
    movlt r9, r8
    movlt r8, r7
    movlt r7, r0    @ Set current highest to elf running total if highest is less than it.
    blt .ranked
    cmp r8, r0
    movlt r9, r8
    movlt r8, r0    @ Else set current 2nd highest to elf running total if 2nd highest is less than it.
    blt .ranked
    cmp r9, r0
    movlt r9, r0    @ @ Set current 3rd highest to elf running total if 3rd highest is less than it.
.ranked:
    eor r0, r0      @ Reset elf running total.

    ldrb r4, [r2], #1   @ Get character.
    cmp r4, #'\0'       @ Check if null terminator a.k.a end of data.
    beq .finished
    b .elfLoop

.finished:
    ldr r0, =output
    mov r1, r7
    mov r2, r8
    mov r3, r9
    @ Also calculate total.
    mov r10, r7
    add r10, r10, r8
    add r10, r10, r9
    push {r10}
    bl printf

@ DS Software must loop infinitely.
.infloop:
	b .infloop

@ Parses an integer from a string, stopping at the first non-numerical character.
@ param r2: Address of the string to parse.
@ return r3: The parsed integer.
parseInt:
    push {lr}

    eor r3, r3  @ Running total = 0.
.parseIntLoop:
    ldrb r4, [r2], #1   @ Get character.

    cmp r4, #'0'
    blt .parseIntDone       @ If < '0', not a numerical character, so finish.
    cmp r4, #'9'
    bgt .parseIntDone       @ If > '9', not a numerical character, so finish.
    sub r4, #'0'            @ Convert to numerical digit.
    mov r5, r3
    mov r6, #10
    mul r3, r5, r6          @ Multiply running total by 10.
    add r3, r3, r4          @ Add parsed digit.
    b .parseIntLoop
.parseIntDone:
    pop {pc}

.section .rodata

@ Initial output.
intro: .ascii "AOC 2022 - Day 1 - Part 2\n\000"
@ Output upon finishing.
output:	.ascii	"\nThe 3 highest elf calorie totals are %i, %i and %i, totaling %i!\n\000"

@ Embed data as text.
data:
.ascii "3864\n5112\n3233\n3008\n5052\n3291\n4002\n5402\n2907\n2398\n3014\n3923\n1475\n1997\n2519\n\n9130\n9712\n12437\n3457\n11610\n4598\n\n1698\n1551\n6798\n7440\n3574\n12107\n3697\n\n9019\n12113\n6266\n11838\n7562\n6444\n\n10364\n1437\n10513\n2988\n10836\n13749\n\n3011\n9552\n11575\n12646\n9861\n6347\n\n15883\n15888\n6725\n7353\n4998\n\n3165\n7637\n6348\n3250\n13535\n12802\n\n6683\n13364\n15858\n5489\n5315\n\n12294\n13732\n9734\n6165\n\n6023\n2374\n5773\n5578\n6419\n4301\n6861\n4560\n6021\n2960\n1349\n\n1847\n2687\n4164\n3599\n4361\n7463\n3010\n4351\n6738\n7941\n3855\n\n1848\n6606\n1662\n4276\n2488\n3635\n1954\n2375\n2020\n6327\n4907\n4523\n1756\n\n25495\n6242\n\n20001\n19849\n1924\n\n14631\n12374\n3017\n16388\n\n4779\n3772\n5719\n3491\n5698\n4909\n5656\n3250\n3805\n4068\n1689\n5141\n5754\n5097\n1951\n\n1824\n1235\n5428\n4808\n5453\n6331\n8706\n2132\n2107\n4675\n\n8668\n11626\n8358\n8178\n3039\n\n6897\n2675\n5347\n6427\n7065\n1305\n5852\n4200\n4995\n5786\n7447\n6742\n\n3863\n5824\n1725\n3534\n5440\n5958\n5225\n1794\n3812\n5589\n3028\n1252\n1746\n1196\n5477\n\n3938\n2800\n8859\n7153\n4821\n3198\n2694\n4947\n\n6697\n3509\n4723\n3891\n6796\n1662\n1369\n3632\n3649\n6928\n2270\n5340\n\n20974\n30984\n\n7699\n5994\n4189\n4527\n11298\n3529\n2212\n\n2603\n2414\n8646\n3184\n4391\n5234\n7213\n7920\n2147\n1809\n\n5039\n7539\n4470\n2247\n9676\n12772\n\n1630\n8375\n9097\n9007\n7498\n5776\n8173\n8946\n\n1130\n3475\n5415\n4784\n5293\n5724\n1730\n2220\n4327\n4915\n4210\n2089\n2161\n\n54387\n\n5235\n6486\n6332\n6169\n4904\n3117\n4987\n5488\n3506\n6267\n3229\n2268\n2058\n2575\n\n10343\n7175\n7614\n1014\n8145\n7014\n8807\n7703\n\n2942\n2045\n9735\n6097\n9103\n3805\n10274\n4901\n\n5227\n6127\n6923\n3691\n2423\n4298\n4130\n5149\n6163\n3855\n2709\n4583\n5465\n\n6713\n7303\n2326\n1054\n2108\n6795\n1399\n5164\n8389\n1413\n\n11210\n2885\n2768\n4565\n7853\n8590\n4953\n\n3359\n5464\n6359\n9578\n3986\n3114\n2449\n5502\n8884\n\n4380\n6795\n6388\n3666\n6385\n5336\n4891\n2633\n6116\n4340\n6410\n2381\n5618\n\n6611\n8713\n3262\n2084\n5305\n6025\n6210\n4838\n6432\n1770\n\n7316\n7253\n1999\n2136\n9789\n6351\n9843\n6965\n\n13110\n10487\n2738\n11418\n5886\n4257\n\n5279\n3005\n5787\n4700\n4579\n5366\n4134\n3856\n4433\n4225\n1119\n3261\n1206\n\n7528\n6795\n3581\n7530\n4287\n3004\n4899\n1682\n6540\n8041\n1163\n\n5271\n9504\n4466\n5030\n9039\n6302\n9526\n5770\n7822\n\n3927\n1053\n7169\n8745\n6919\n8249\n1402\n5462\n2763\n7113\n\n4657\n20694\n21592\n\n4904\n6515\n9389\n9141\n5209\n1682\n7319\n9383\n4057\n\n13752\n9584\n8823\n\n2085\n8569\n6909\n6769\n7842\n1740\n8757\n2428\n1151\n\n1240\n6410\n5661\n1817\n4367\n6749\n3837\n3287\n2126\n\n48984\n\n5064\n2260\n7884\n6506\n1312\n2949\n\n2501\n3041\n5435\n4134\n4921\n9071\n1539\n8718\n4927\n\n13457\n13830\n14262\n16094\n6856\n\n4134\n5955\n2100\n3580\n1618\n6258\n2037\n3407\n6043\n5882\n5180\n5852\n1142\n\n6315\n3132\n4804\n7315\n1145\n6572\n4295\n1818\n6889\n3224\n2124\n4383\n\n49471\n\n16847\n14810\n10031\n15268\n\n9925\n13290\n11355\n12632\n7822\n\n2393\n2849\n1713\n6708\n2818\n7002\n4987\n2814\n1650\n5845\n6962\n3250\n\n3022\n4101\n6484\n6655\n5900\n3114\n2479\n7243\n3711\n3322\n3543\n6403\n\n3922\n6921\n2825\n3470\n6452\n1334\n7415\n4350\n1250\n6732\n6071\n\n13203\n10169\n14375\n9425\n6521\n\n14621\n8430\n19479\n10045\n\n5082\n1198\n1420\n2902\n2764\n3099\n6677\n5280\n1059\n2165\n6836\n\n1275\n7294\n5909\n4850\n3642\n4437\n7639\n2001\n8353\n7923\n\n65166\n\n8180\n2720\n5919\n1586\n7115\n2500\n1213\n8595\n6904\n1338\n\n3154\n6288\n8212\n7799\n4547\n5465\n4819\n4080\n7698\n\n4718\n2231\n3672\n4929\n3608\n1125\n1283\n3307\n5198\n6605\n5178\n5314\n1539\n\n5772\n5108\n5245\n3701\n2893\n5852\n2399\n4988\n4363\n4949\n5894\n6708\n\n7223\n3143\n8012\n1442\n5661\n8021\n6281\n5132\n3742\n3028\n5716\n\n1439\n9221\n8094\n7476\n1144\n1889\n4245\n6198\n9020\n\n6934\n5060\n2312\n1886\n1988\n4895\n7235\n1647\n2814\n3147\n5432\n7285\n\n39249\n\n18283\n24247\n1734\n\n7175\n\n7790\n7393\n12909\n14444\n4285\n\n4692\n7363\n6394\n7058\n4988\n5041\n1886\n2515\n1490\n2791\n5734\n2365\n\n1468\n8324\n23095\n\n4178\n5102\n5153\n3115\n4749\n1387\n5849\n2752\n1318\n5515\n6390\n3345\n5912\n5829\n\n4765\n4421\n1225\n3593\n8691\n6986\n7451\n8529\n5251\n4784\n\n2862\n3838\n7199\n7330\n2514\n8670\n8281\n3576\n4912\n2260\n\n1962\n5598\n4649\n5922\n4135\n4373\n6511\n5068\n3156\n2439\n6200\n1464\n4222\n\n5741\n10630\n3768\n3343\n8548\n3202\n2871\n\n6916\n17569\n24608\n\n7823\n7460\n6920\n3049\n8003\n3858\n3611\n4790\n3392\n\n27393\n\n4616\n8220\n1239\n7295\n6397\n1372\n\n17576\n18361\n10204\n13704\n\n15826\n3578\n14185\n2385\n1221\n\n5127\n3905\n4206\n1073\n5846\n2267\n1482\n1450\n1451\n2768\n2849\n2850\n3312\n1479\n5513\n\n10345\n4158\n12513\n5591\n16153\n\n6027\n1377\n1804\n3795\n5796\n2626\n6336\n3746\n6146\n6311\n6113\n4062\n3067\n\n2448\n1058\n4229\n3204\n6020\n2882\n5419\n2084\n3590\n5993\n3840\n1156\n2502\n1817\n6055\n\n32707\n1241\n\n3045\n1309\n3599\n3823\n2307\n1547\n1612\n6550\n3459\n5435\n1056\n4990\n4650\n\n4354\n6100\n2169\n2654\n6645\n4525\n2880\n2747\n6052\n6365\n5701\n\n1503\n1293\n2530\n9166\n8656\n9926\n9255\n7066\n\n9305\n7085\n6824\n9498\n9025\n7904\n3118\n3142\n\n10108\n2329\n4742\n8494\n1708\n1343\n3350\n6716\n\n6532\n2895\n4189\n1971\n7834\n1107\n1027\n6415\n1211\n3023\n1636\n\n4973\n5464\n3843\n6092\n2053\n1745\n6005\n5862\n4142\n1415\n4875\n1617\n5642\n1920\n4706\n\n7408\n17800\n11194\n13159\n\n5566\n1756\n2450\n5854\n1639\n3928\n2742\n6385\n6120\n5802\n1599\n1249\n3625\n\n1670\n4618\n5316\n3653\n5167\n3252\n4995\n1200\n3446\n4433\n6113\n1342\n4176\n5753\n\n4597\n9620\n3712\n1774\n5338\n4078\n7296\n3434\n9310\n\n8976\n12080\n8938\n6131\n10273\n10621\n4234\n\n6447\n13533\n10763\n11732\n5190\n9129\n\n5281\n3655\n5424\n5314\n3908\n5582\n3114\n1744\n5385\n3111\n4497\n2897\n4401\n1298\n\n12623\n8559\n12761\n1280\n12850\n11620\n\n1809\n2403\n2257\n4586\n4585\n5761\n3264\n4621\n1045\n2354\n1954\n\n5074\n7245\n5125\n6481\n6424\n5650\n6906\n1789\n5924\n1086\n1690\n2558\n\n3471\n1419\n10640\n2304\n11881\n11729\n12014\n\n17503\n19515\n15606\n1866\n\n4486\n3617\n9287\n4473\n7289\n1852\n9402\n3964\n3602\n\n7989\n2612\n1003\n7634\n4889\n1978\n5232\n1146\n\n5487\n7770\n8115\n2268\n3609\n3100\n\n6205\n6444\n8414\n2959\n7972\n8829\n6256\n1156\n\n4737\n1069\n3768\n2510\n3527\n5221\n1666\n4470\n3563\n1654\n5734\n3075\n5575\n\n15504\n12559\n8976\n9824\n8990\n\n7934\n3476\n6965\n3686\n3923\n2709\n8648\n7699\n\n6772\n3077\n2503\n4261\n2890\n3068\n3921\n4858\n4882\n2770\n5354\n6859\n3445\n\n52484\n\n11901\n15405\n13990\n17226\n\n5850\n4678\n5707\n5673\n1485\n3913\n3480\n5013\n2565\n2062\n2406\n6342\n5828\n\n4758\n3972\n5428\n7975\n1407\n5563\n4808\n7919\n4359\n5078\n3682\n\n18959\n4053\n1937\n6684\n\n6150\n2908\n4347\n1341\n6863\n6723\n2992\n4434\n6267\n4876\n\n4458\n12449\n10626\n4621\n3687\n9892\n\n13207\n1659\n18006\n12201\n\n6923\n2813\n2898\n1837\n5875\n4333\n5434\n1703\n1930\n3207\n4145\n6236\n5833\n\n8993\n6150\n10505\n2085\n9550\n9271\n11322\n\n3046\n2665\n1049\n2145\n1082\n2523\n3809\n3976\n1052\n3415\n3224\n3522\n3740\n4872\n2536\n\n23303\n24203\n6904\n\n5562\n1246\n3109\n4849\n3079\n4853\n2026\n5356\n4397\n2953\n6317\n6009\n4248\n2557\n\n14594\n25779\n16865\n\n1229\n5756\n3663\n5951\n7077\n1950\n3508\n\n3758\n4208\n8189\n10315\n3057\n2813\n4001\n\n7597\n1192\n8466\n10400\n4446\n7610\n6265\n3735\n\n7012\n2301\n12432\n4820\n1329\n\n12293\n4034\n\n4964\n3467\n2701\n5807\n3710\n4313\n3761\n3127\n4525\n2948\n4560\n1989\n3900\n4193\n4177\n\n11249\n36854\n\n1034\n4105\n2297\n5906\n3525\n2047\n6844\n2436\n6523\n3394\n2502\n4028\n2509\n\n4336\n3094\n2833\n4452\n6331\n6115\n2301\n3217\n5287\n7749\n7323\n\n4148\n1984\n4102\n6569\n3790\n6576\n3567\n3802\n2742\n6539\n2247\n5713\n6088\n\n4975\n1430\n2970\n3669\n1025\n1244\n3788\n1979\n5738\n3292\n3556\n3730\n6105\n3277\n4346\n\n15738\n9547\n16697\n\n66474\n\n4263\n6015\n3324\n3812\n5843\n2654\n1389\n6766\n6319\n1516\n5893\n4485\n2272\n\n12631\n3624\n7153\n16205\n13771\n\n10426\n12897\n17028\n\n9876\n6551\n9756\n1740\n7096\n8600\n7217\n4773\n\n7909\n7798\n9063\n8985\n4679\n1808\n7964\n1699\n4306\n\n4503\n6328\n7241\n2595\n4247\n7351\n4336\n4402\n4159\n\n31634\n\n8118\n1323\n4680\n1149\n4085\n10126\n4137\n3525\n\n8530\n3662\n3779\n8656\n5607\n8840\n7246\n4802\n2720\n\n2839\n5366\n5585\n1265\n6497\n1123\n2588\n3881\n5866\n3361\n5737\n5557\n3432\n3415\n\n1155\n6948\n1379\n3529\n2804\n6611\n2950\n1813\n6580\n6723\n5971\n5549\n\n2561\n2538\n1721\n2674\n2618\n3598\n1152\n5254\n6073\n3352\n1016\n2452\n5835\n5319\n2337\n\n4682\n8460\n8055\n1318\n8906\n7333\n7422\n1762\n3159\n\n4290\n4947\n3993\n1717\n7989\n6175\n3558\n1492\n6565\n7338\n\n1687\n6502\n5542\n6358\n2954\n5758\n5980\n6825\n5866\n1280\n4830\n3345\n\n5162\n3923\n1385\n4797\n3288\n1723\n2312\n5272\n5749\n5538\n4432\n3931\n4573\n2554\n\n7658\n4023\n7144\n6541\n3310\n5114\n4847\n8803\n5657\n1784\n\n4370\n3305\n6516\n5828\n9182\n4402\n9934\n\n6053\n\n8494\n\n6095\n11294\n8547\n10083\n8434\n11764\n2951\n\n2952\n3177\n7103\n4875\n1817\n10323\n1381\n\n13123\n9521\n23873\n\n5787\n12655\n12756\n20017\n\n1849\n4191\n6295\n6289\n2796\n4640\n4409\n1030\n2279\n1813\n1948\n2271\n6518\n\n9749\n1518\n3621\n9996\n9173\n1741\n\n8417\n2916\n6781\n9461\n7940\n8660\n10204\n8902\n\n36117\n\n4928\n11184\n6168\n12046\n3466\n6830\n\n4507\n1340\n5878\n3276\n3793\n6844\n4796\n1096\n5405\n3905\n1762\n5264\n1384\n\n3121\n5572\n5864\n6716\n9604\n1966\n10685\n4693\n\n5684\n5699\n2937\n2273\n1618\n4506\n3601\n5460\n6154\n4258\n6404\n4984\n3264\n1155\n\n4268\n7380\n7893\n3865\n6244\n5745\n7877\n3322\n3627\n\n5996\n4074\n5569\n3507\n6114\n3961\n6042\n5272\n2995\n4667\n2161\n5336\n3922\n5647\n2187\n\n4228\n4393\n5050\n1155\n2427\n4201\n1233\n6100\n5369\n4142\n3524\n3058\n6176\n2121\n\n7869\n8100\n6906\n2028\n3868\n8614\n5236\n1366\n9400\n\n23443\n9993\n8524\n\n1473\n4354\n2258\n5343\n2574\n6151\n4949\n4792\n5509\n5791\n6246\n3977\n5126\n4920\n\n2080\n3619\n2138\n2745\n\n2001\n9394\n7088\n5665\n9985\n8964\n2620\n\n3346\n4344\n15757\n4227\n9296\n\n4465\n5869\n4651\n2306\n3055\n5572\n4963\n3055\n1328\n4879\n6011\n4266\n5300\n1046\n5571\n\n6086\n5882\n21009\n\n4163\n9276\n11926\n2012\n11726\n9290\n\n23241\n20013\n6592\n\n4638\n8473\n2576\n3643\n8712\n5578\n4112\n3300\n4531\n6702\n\n1360\n2866\n5521\n4452\n1437\n6475\n4393\n6121\n4211\n3168\n6841\n3096\n2048\n\n11379\n\n3821\n6927\n1607\n3907\n8928\n4193\n2371\n3760\n7531\n\n3976\n1570\n8665\n8603\n2337\n3396\n3583\n5928\n6876\n6429\n\n9263\n5094\n11647\n3988\n7631\n3263\n\n5716\n8255\n5940\n10735\n7349\n6548\n4650\n5816\n\n1229\n2098\n6221\n5073\n4343\n6126\n3950\n1293\n2848\n4351\n6438\n5156\n2619\n3244\n\n6788\n5274\n2215\n3979\n2788\n7081\n2119\n6235\n1359\n7141\n1497\n3362\n\n6956\n2914\n3014\n5001\n7681\n7144\n2914\n4128\n3004\n6170\n1417\n\n13926\n18761\n6405\n\n2805\n2134\n5990\n1899\n3919\n3040\n2357\n2352\n2295\n3900\n1039\n4151\n\n21789\n17570\n24738\n\n3241\n9968\n5793\n8790\n10130\n6838\n2229\n9715\n\n7270\n6954\n10077\n10701\n10903\n4370\n\n7931\n3629\n14710\n2728\n5862\n\n2262\n2517\n3677\n4296\n1177\n5268\n3759\n4892\n2275\n6369\n4674\n4536\n1970\n\n8547\n4623\n1624\n7643\n9658\n6489\n1199\n7866\n9443\n\n6363\n6567\n2584\n9352\n8291\n10254\n3179\n4177\n\n1358\n4057\n5758\n1719\n5758\n5143\n5942\n3502\n1033\n3488\n4825\n2379\n5280\n4139\n2928\n\n16444\n23345\n\n1933\n3294\n5717\n7357\n2773\n7946\n3876\n7471\n5962\n4976\n6369\n\n14677\n9136\n24025\n\n14151\n18024\n4880\n10196\n\n1152\n5591\n5800\n2475\n5481\n7792\n6041\n1224\n1138\n5768\n3158\n\n2689\n3417\n4316\n1811\n1853\n4110\n1860\n2250\n6493\n3285\n6372\n2214\n4907\n5587\n\n3713\n4494\n3322\n5279\n2203\n5933\n4894\n1353\n4219\n1011\n\n4117\n2122\n4192\n3719\n1855\n1842\n3312\n2056\n3121\n1974\n5752\n3417\n4830\n3341\n3080\n\n5172\n5003\n2775\n4138\n5964\n4643\n5584\n5634\n3776\n5664\n3815\n1702\n5195\n6368\n\n8665\n\n41002\n\n4531\n5677\n2926\n2964\n3287\n2916\n2527\n1677\n1535\n3773\n6299\n5507\n3247\n\n6025\n8452\n9375\n8793\n4184\n6122\n11183\n\n21084\n\n2635\n7467\n1635\n2903\n2572\n4592\n7070\n4212\n8780\n\n4910\n7018\n6084\n3618\n1922\n2781\n2283\n1541\n1971\n1445\n1528\n6543\n\n6867\n5700\n4220\n8066\n3951\n1890\n7064\n2486\n3213\n1323\n\n49337\n\n2188\n7181\n6604\n5420\n4804\n5447\n2652\n1824\n5731\n3217\n2954\n7297\n\n4106\n3442\n6464\n6654\n3723\n1293\n6951\n3407\n3993\n3524\n\n2163\n5961\n6245\n1510\n4674\n6248\n2035\n1510\n1105\n4586\n5132\n5687\n5381\n2342\n\n15330\n22553\n25696\n\n6825\n3520\n3181\n2552\n1875\n2522\n4232\n1897\n6190\n1155\n4446\n2414\n5686\n\n6164\n5650\n4649\n6471\n2415\n1229\n6458\n6585\n6982\n2279\n4215\n3518\n\n5048\n5614\n2542\n5841\n1986\n10453\n8196\n9669\n\n8040\n4567\n7515\n2496\n5786\n1226\n8596\n2383\n7726\n1760\n\0"